<!DOCTYPE html>
<html>
<meta charset="UTF-8">
<head>

<title>Convertisseur - Mots-clés</title>
</head>
<body style="background-color:#dcd7d5";>
<h1>L'extracteur à mots clés 2000® (Shutterstock uniquement)</h1>
<br>

Attribution et format:
<select id="attribution">
   <option value="automatique" selected="selected">Automatique</option>
   <option value="royalty-free">Royalty-free</option>
   <option value="editorial">Editorial</option>
</select>

<select id="format">
   <option value="automatique" selected="selected">Automatique</option>
   <option value="horizontal">Horizontal</option>
   <option value="vertical">Vertical</option>
</select>

<br>
<form>
<h2>Veuillez coller le code-source.</h2>
<p><textarea style="background-color:#eeeeee"; id="texte" rows="8" cols="60"></textarea></p>
<input type="button" value="Soumettre" onclick="SubmitFonc()">
</form>

<br>
<br>

<p><textarea style="background-color:#eeeeee"; id="texte_sortie" rows="8" cols="60"></textarea></p>

<script  type='text/javascript'>

document.getElementById("texte");
texte.select();

function SubmitFonc() {     // début de la fonction liée au bouton

var code_source = document.getElementById("texte").value;
var format = document.getElementById("format").value;
var attribution= document.getElementById("attribution").value;

if (code_source == "" &&  attribution == "automatique" || code_source == "" && format == "automatique") {
alert("Pour la détection automatique, un code-source doit être entré. Sinon, renseignez manuellement les étiquettes.")
return true;  }
else if (code_source == "") {

   keywords = [];

   keywords.unshift(attribution);
   keywords.unshift(format);

   keywords = keywords.toString();
   keywords = keywords.replace(/,/g, ", ");



   document.getElementById('texte_sortie');
   texte_sortie.innerText = keywords;
   return true; }


code_source = code_source.replace(/\\/g, "");
code_source = code_source.replace(/"/g, "");
code_source = code_source.replace(/:/g, " ");
code_source = code_source.replace(/,/g, " ");

code_source = code_source.split(' ');

if (code_source.length < 1000) {
   alert("Il semblerait qu'il y ait une erreur avec le code source");
   return true;   }

var position = code_source.indexOf("keywords");

position = position + 1;

for (var i = position; i < (position + 155); i++)
{
    if (code_source[i].indexOf(']') != -1)
    {
       var end = i;
       break;
    }

   if (end == i) break;
   else if (i == (position + 150)) {
                 alert("Il semblerait qu'il y ait une erreur avec le code source");
                 return true; }

}

end = end +1;

keywords = code_source.slice(position, end);

if ( attribution == "automatique") {

var position2 = code_source.indexOf("isEditorial");
position2 = position2 + 1;

  if (code_source[position2] == "false") attribution = "royalty-free";
  else attribution = "editorial";
}

if (format == "automatique") {
code_source = document.getElementById("texte").value;

code_source = code_source.replace(/"/g, " ");
code_source = code_source.replace(/\./g, " ");
code_source = code_source.replace(/:/g, " ");
code_source = code_source.replace(/;/g, " ");
code_source = code_source.split(' ');

var position3 = code_source.indexOf("max-width");

position3 = position3 + 1;

var w = code_source[position3];
w = w - "";

position3 = code_source.indexOf("max-height");
position3 = position3 + 1;

var h = code_source[position3];
h = h - "";

  if (w - h == 0 || w - h > 0) format = "horizontal"
  else format = "vertical"
}

keywords.unshift(attribution);
keywords.unshift(format);

keywords = keywords.toString();
keywords = keywords.replace(/[\[\]']+/g, "");
keywords = keywords.replace(/,/g, ", ");



document.getElementById('texte_sortie');
texte_sortie.innerText = keywords;


                                        }                                   // fin de la fonction principale liée au bouton



</script>

<h2>Instructions</h2>
<p>
1. Rechercher une image sur Shutterstock (s'assurer d'être sur le lien en anglais pour avoir des mots-clés en anglais).
<br>
<br>
2. Faire «Ctrl + u», puis «Ctrl + a» et «Ctrl + c»*.
<br>
<br>
3. Coller le code-source et cliquer sur «Soumettre».
<br>
<br>
Note: Si vous éprouvez des problèmes avec la détection automatique, il est possible de «forcer» les étiquettes d'attribution et de format en les sélectionnant manuellement. Aussi, si l'image contient plus de 150 mots-clés, ce qui m'étonnerait, le processus est arrêté et un message d'erreur s'affiche. Cela pourrait arriver aussi si les données d'une image sont structurées différemment des modèles que j'ai utilisés.
Merci de me communiquer les images dont l'extraction des mots-clés a échoué afin que je puisse améliorer mon script.
<br>
<br>
*Raccourcis testés sur Windows. Sinon, faites clic-droit, «afficher le code-source», puis sélectionnez-le en entier pour le coller ensuite dans la boîte prévue à cet effet.
</p>

</body>
</html>
